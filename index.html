<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Token Transfer</title>
</head>
<body>
    <h1>Solana Token Transfer</h1>
    <div>
        <label for="tokenMintAddress">Token Mint Address:</label>
        <input type="text" id="tokenMintAddress" placeholder="Enter token mint address">
    </div>
    <div>
        <label for="recipientAddress">Recipient Address:</label>
        <input type="text" id="recipientAddress" placeholder="Enter recipient address">
    </div>
    <div>
        <label for="amount">Amount:</label>
        <input type="number" id="amount" placeholder="Enter amount">
    </div>
    <button id="transferButton">Transfer Tokens</button>
    <div id="status"></div>

    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token"></script>
    <script>
        document.getElementById("transferButton").addEventListener("click", async () => {
            try {
                const tokenMintAddress = document.getElementById("tokenMintAddress").value;
                const recipientAddress = document.getElementById("recipientAddress").value;
                const amount = parseInt(document.getElementById("amount").value);

                const connection = new web3.Connection(web3.clusterApiUrl('devnet')); // or 'mainnet-beta' for the mainnet

                const wallet = web3.Keypair.generate(); // Create a new wallet keypair

                // Transfer tokens
                await transfer(tokenMintAddress, wallet, recipientAddress, connection, amount);

                document.getElementById("status").textContent = "Tokens transferred successfully!";
            } catch (error) {
                console.error("Error transferring tokens:", error);
                document.getElementById("status").textContent = "Transaction failed";
            }
        });

        async function transfer(tokenMintAddress, wallet, to, connection, amount) {
            const mintPublicKey = new web3.PublicKey(tokenMintAddress);
            const mintToken = new splToken.Token(
                connection,
                mintPublicKey,
                splToken.TOKEN_PROGRAM_ID,
                wallet
            );

            const fromTokenAccount = await mintToken.getOrCreateAssociatedAccountInfo(
                wallet.publicKey
            );

            const destPublicKey = new web3.PublicKey(to);

            const associatedDestinationTokenAddr = await splToken.Token.getAssociatedTokenAddress(
                splToken.TOKEN_PROGRAM_ID,
                splToken.TOKEN_PROGRAM_ID,
                mintPublicKey,
                destPublicKey
            );

            const receiverAccount = await connection.getAccountInfo(associatedDestinationTokenAddr);

            const instructions = [];

            if (receiverAccount === null) {
                instructions.push(
                    splToken.Token.createAssociatedTokenAccountInstruction(
                        splToken.TOKEN_PROGRAM_ID,
                        splToken.TOKEN_PROGRAM_ID,
                        mintPublicKey,
                        associatedDestinationTokenAddr,
                        destPublicKey,
                        wallet.publicKey
                    )
                );
            }

            instructions.push(
                splToken.Token.createTransferInstruction(
                    splToken.TOKEN_PROGRAM_ID,
                    fromTokenAccount.address,
                    associatedDestinationTokenAddr,
                    wallet.publicKey,
                    [],
                    amount
                )
            );

            const transaction = new web3.Transaction().add(...instructions);
            transaction.feePayer = wallet.publicKey;
            transaction.recentBlockhash = (
                await connection.getRecentBlockhash()
            ).blockhash;

            const transactionSignature = await web3.sendAndConfirmTransaction(
                connection,
                transaction,
                [wallet],
                { commitment: 'confirmed' }
            );

            return transactionSignature;
        }
    </script>
</body>
</html>
