<!DOCTYPE html>
<html>
<head>
  <title>Solana Token Transfer DApp</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@latest/lib/cjs/index.min.js"></script>
</head>
<body>
  <h1>Solana Token Transfer</h1>
  <div>
    <label for="tokenAddress">Token Address:</label>
    <input type="text" id="tokenAddress" placeholder="Enter token address">
  </div>
  <div>
    <label for="receiverAddress">Receiver Address:</label>
    <input type="text" id="receiverAddress" placeholder="Enter receiver address">
  </div>
  <div>
    <label for="amount">Amount:</label>
    <input type="number" id="amount" placeholder="Enter amount">
  </div>
  <button id="connectWallet">Connect Wallet</button>
  <button id="transferTokens" disabled>Transfer Tokens</button>
  <div id="status"></div>
  <script type="module">
    // Your JavaScript code goes here
    import { getTokenAccountsByOwner } from 'https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js';
    const connectButton = document.getElementById("connectWallet");
const transferButton = document.getElementById("transferTokens");
const statusElement = document.getElementById("status");

connectButton.addEventListener("click", async () => {
  try {
    const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
    const provider = window.solana; // Access wallet provider globally
    const wallet = await provider.connect();
    const publicKey = wallet.publicKey.toBase58();
    statusElement.textContent = `Connected to wallet: ${publicKey}`;
    transferButton.disabled = false;
  } catch (error) {
    console.error("Error connecting to wallet:", error);
    statusElement.textContent = "Wallet connection failed";
  }
});

transferButton.addEventListener("click", async () => {
  try {
    const tokenAddress = document.getElementById("tokenAddress").value;
    const receiverAddress = document.getElementById("receiverAddress").value;
    const amount = document.getElementById("amount").value;

    const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
    const provider = window.solana;
    const wallet = await provider.connect();

    const token = new solanaWeb3.PublicKey(tokenAddress);
    const receiver = new solanaWeb3.PublicKey(receiverAddress);
        // Get associated token accounts (source and destination)

// Define variables to hold ATA addresses
let sourceAddress;
let destinationAddress;

const [sourceExists, sourceAccount] = await connection.getTokenAccountsByOwner(
  wallet,
  token,
);

const [destExists, destAccount] = await connection.getTokenAccountsByOwner(
  receiver,
  token,
);
sourceAddress = sourceAccount.accountInfo.address; 
destinationAddress = destAccount.accountInfo.address; 

        // Create transfer instruction
        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.Token.createTransferInstruction(
            solanaWeb3.TOKEN_PROGRAM_ID,
            sourceAddress,
            destinationAddress,
            wallet.publicKey,
            [],
            parseInt(amount),
          )
        );
// Sign and send the transaction
await wallet.signTransaction(transaction);
const signature = await connection.sendRawTransaction(transaction);

statusElement.textContent = `Transaction submitted: ${signature}`;

// Handle transaction confirmation and potential errors
connection.onSignatureStatus(
  signature,
  ({ status, err }) => {
    if (err) {
      statusElement.textContent = `Transaction failed: ${err.message}`;
    } else if (status === "confirmed") {
      statusElement.textContent = `Transaction succeeded: ${signature}`;
    }
  }
);
  } catch (error) {
    console.error("Error transferring tokens:", error);
    statusElement.textContent = "Transaction failed";
  }
});

  </script>
</body>
</html>
